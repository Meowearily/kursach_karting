from __future__ import annotations

from sqlmodel import Session

from db import engine, init_db, seed_demo_data
from request import get_available_karts, get_races_with_participants


def main() -> None:
    """CLI entrypoint for quick local testing without running FastAPI."""
    init_db()
    seed_demo_data()
    with Session(engine) as session:
        print("Available karts:")
        for kart in get_available_karts(session):
            print(f"- {kart.model} (rain-ready: {kart.rain})")

        print("\nRaces and participants:")
        for race_info in get_races_with_participants(session):
            print(f"Race #{race_info['race_id']} on {race_info['track']}")
            for p in race_info["participants"]:
                print(
                    f"  {p['racer']} on {p['kart']} time: {p['duration']}",
                )
            if race_info["staff"]:
                print("  Staff: " + ", ".join(race_info["staff"]))


if __name__ == "__main__":
    main()

